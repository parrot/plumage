# Copyright (C) 2009, Parrot Foundation.

# Command aliases and portability fixes
PERL        := @perl@
RM_F        := @rm_f@

O           := @o@
EXE         := @exe@

PARROT_BIN  := @bindir@
PARROT_LIB  := @libdir@@versiondir@

PARROT      := $(PARROT_BIN)/parrot
PBC_TO_EXE  := $(PARROT_BIN)/pbc_to_exe
NQP_PBC     := $(PARROT_LIB)/languages/nqp/nqp.pbc

# The default target
all: plumage

# List all user-visible targest
help:
	@echo ""
	@echo "The following targets are available:"
	@echo ""
	@echo "  all:         Generate plumage executable (default target)"
	@echo "  clean:       Clean generated files"
	@echo "  help:        Print this help message"
	@echo ""

plumage: src/plumage.pbc src/lib/Glue.pbc
	$(PBC_TO_EXE) src/plumage.pbc

src/plumage.pbc: src/lib/plumage.pir
	$(PARROT) -o src/plumage.pbc src/lib/plumage.pir

src/lib/plumage.pir: src/plumage.nqp
	$(PARROT) $(NQP_PBC) --target=pir -o src/lib/plumage.pir src/plumage.nqp

src/lib/Glue.pbc: src/lib/Glue.pir
	$(PARROT) -o src/lib/Glue.pbc src/lib/Glue.pir


# Convenience
realclean: clean

clean:
	$(RM_F) "*~" "src/lib/*.pbc" "src/*.pbc" "*$(O)" "src/*.c" src/lib/plumage.pir plumage$(EXE) Makefile

# Local variables:
#   mode: makefile
# End:
# vim: ft=make:
