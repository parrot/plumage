# Copyright (C) 2009, Parrot Foundation.

# Command aliases and portability fixes
PERL        := @perl@
RM_F        := @rm_f@

O           := @o@
EXE         := @exe@

PARROT_BIN  := @bindir@
PARROT_LIB  := @libdir@@versiondir@

PARROT      := $(PARROT_BIN)/parrot
PBC_TO_EXE  := $(PARROT_BIN)/pbc_to_exe
NQP_PBC     := $(PARROT_LIB)/languages/nqp/nqp.pbc

# The default target
all: plumage

# List all user-visible targest
help:
	@echo ""
	@echo "The following targets are available:"
	@echo ""
	@echo "  all:         Generate plumage executable (default target)"
	@echo "  clean:       Clean generated files"
	@echo "  help:        Print this help message"
	@echo ""

plumage: plumage.pbc Glue.pbc
	$(PBC_TO_EXE) plumage.pbc

plumage.pbc: pir/plumage.pir
	$(PARROT) -o plumage.pbc pir/plumage.pir

pir/plumage.pir: plumage.nqp
	$(PARROT) $(NQP_PBC) --target=pir -o pir/plumage.pir plumage.nqp

Glue.pbc: pir/Glue.pir
	$(PARROT) -o Glue.pbc pir/Glue.pir


# Convenience
realclean: clean

clean:
	$(RM_F) "*~" "*.pbc" "*$(O)" "*.c" pir/plumage.pir plumage$(EXE) Makefile

# Local variables:
#   mode: makefile
# End:
# vim: ft=make:
